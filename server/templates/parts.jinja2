{% extends "dashboard.jinja2" %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dropdown.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/lists.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
{% endblock %}

{% block path %}
    <a href="/errors"><i class="ph ph-bug-beetle"></i> Errors</a> {% if project %} <i class="ph ph-caret-right"></i> <a href="/errors/{{ project.id }}"><i class="{{ project.icon }}"></i> {{ project.name }}</a> {% endif %}
{% endblock %}

{% block content %}

<h1>Project parts error management</h1>

<div class="project-tabs" id="project-tabs">
    <button class="project-tab {% if not project %}active{% endif %}" data-project="all" onclick="window.location.href = '/errors'">
        <i class="ph ph-squares-four"></i> All
    </button>
    <!-- Project tabs will be populated dynamically -->

    {% for proj in projects %}
    <button class="project-tab {% if proj.id == project.id %}active{% endif %}" data-project="{{ proj.id }}" onclick="window.location.href = '/errors/{{ proj.id }}' ">
        <i class="{{ proj.icon }}"></i> {{ proj.name }}
    </button>
    {% endfor %}

</div>

<div id="ticket-list"></div>

{% endblock %}

{% block scripts %}

    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="{{ url_for('static', filename='js/dropdown.js') }}"></script>
    <script src="{{ url_for('static', filename='js/lists.js') }}"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const partList = new List('ticket-list', {
                filters: {
                    search: { placeholder: 'Search errors...' },
                    labels: { label: 'Labels' },
                    assignees: { label: 'Assignees' },
                    urgency: { label: 'Urgency' },
                    dateRange: { label: 'Date' }
                },
                groupBy: {
                    options: ['none', 'urgency', 'assignees', 'labels'],
                    default: 'none'
                }
            });

            const partListItems = [
                {% for part in project_parts %}
                {
                    id: '{{ part.project.id }}',
                    title: '{{ part.name }}',
                    description: '{{ part.description | default("No description provided.", true) | safe }}',
                    icon: '{{ part.project.icon }}',
                    {# labels: [
                        {% for label in ticket.labels %}
                        {text: '{{ label.name }}', color: '{{ label.color }}'},
                        {% endfor %}
                    ], #}
                    {# assignees: [
                        {% for assignee in ticket.assignees %}
                        '{{ assignee }}',
                        {% endfor %}
                    ], #}
                    {# createdAt: '{{ part.created_at }}', #}
                    project: '{{ part.project.id }}',
                    onClick: () => { window.location.href = '/errors/{{ part.project.id }}/{{ part.id }}'; }
                },
                {% endfor %}
            ];

            partListItems.forEach(part => partList.add(part));
        });
    </script>

{% endblock %}
